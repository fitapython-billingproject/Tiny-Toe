
<!DOCTYPE html>
<html>    
<head>
   
    <title>Tiny Toe Billing</title>
    <style>
        body { font-family: 'Comic Sans MS'; background:url("https://st2.depositphotos.com/2933025/7386/i/950/depositphotos_73861925-stock-photo-newborn-baby-girl-seamless-pattern.jpg ");background-size:cover}
        .container { max-width: 900px; margin: 0 auto;  border-radius:25px;  padding: 30px; background:url("https://tse1.mm.bing.net/th/id/OIP.clQfrzJXbtBBTJFVRz2XXwHaGG?w=1136&h=936&rs=1&pid=ImgDetMain&o=7&rm=3");background-size:center;position:relative;overflow:hidden;box-shadow: 0 20px 40px rgba(0,0,0,0.1); border: 3px solid #FFB6C1; }
        .container::before {
          content: "";
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: inherit;  
          background-position: center;   
          background-size: cover;      
          filter: blur(3px) brightness(0.9) contrast(1.2) saturate(1.3);    
          z-index:0;
        }
        .container > * { position: relative; z-index: 1; }
        
        .title { text-align:center; font-size:3.5rem; color:hsl(330, 95%, 50%); margin-bottom:30px; }
        .title::before { content: "üë∂ "; animation: bounce 2s infinite; display:inline-block; }
        .title::after { content: " üçº"; animation: bounce 2s infinite 0.5s; display:inline-block; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px) scale(1.1); } }

        .form-group { margin-bottom: 20px; }
        label { display:block; font-weight:bold; color:#f4057c; margin-bottom:8px; font-size:1.5rem }
        input, select {
            width:100%; padding:12px; border:2px solid #FFB6C1; border-radius:25px; font-size:1rem;
            box-sizing: border-box; height:48px; line-height:1.5rem; appearance:none;
            -webkit-appearance:none; -moz-appearance:none; background-color:#fff;
        }
        select {
            background: #fff url("data:image/svg+xml;utf8,<svg fill='pink' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>") no-repeat right 12px center;
            background-size:20px; padding-right:40px;
        }
        .add-btn { background: linear-gradient(45deg, #ec0e7d,#FFB6C1); color:white; border:none; padding:15px 30px; border-radius:25px; font-size:1.5rem; cursor:pointer; display:block; margin:20px auto; }
        .cart-table { width:100%; border-collapse: collapse; margin:20px 0;font-size:1.5rem;color:#f4057c }
        .cart-table th, .cart-table td { padding:12px; text-align:center; border-bottom:1px solid #FFE4E1; }
        .total-section { background: linear-gradient(45deg, #FFD700, #FFA500); padding:15px; border-radius:15px; text-align:center; color:white; font-size:1.3rem; font-weight:bold; margin:15px 0; }
        .generate-btn { background: linear-gradient(45deg, #32CD32,#98FB98); color:white; border:none; padding:18px 40px; border-radius:25px; font-size:1.4rem; cursor:pointer; width:100%; margin-top:20px; }
        .remove-btn { background: #FF6B6B; color: white; border: none; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 0.9rem; }
        .remove-btn:hover { background: #f7061a; transform: scale(1.05); }
    </style>
</head>
<body>
<div class="container">
  <h1 class="title">Tiny Toe</h1>
  <div class="form-group">
    <label>üë§ Customer Name</label>
    <input type="text" id="customerName" placeholder="Enter consumer  name...">
  </div>
  <div class="form-group">
    <label>üì± Phone no</label>
    <input type="tel" id="phoneNo" placeholder="Contact number..."maxlength="10" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,10)">
  </div>
  <div class="form-group">
    <label>üß∏ Products</label>
    <select id="products">
        <option value="">Choose baby item...</option>
    </select>
  </div>
  <div class="form-group">
    <label>üì¶ Quantity</label>
    <input type="number" id="quantity" min="1" value="1">
  </div>

  <div class="form-group">
  <label>üìß Email (Optional)</label>
  <input type="email" id="email" placeholder="example@gmail.com"
         pattern="[a-z0-9._%+-]+@gmail\.com" 
         title="Only Gmail addresses allowed (example@gmail.com)">
</div>


  <div class="form-group">
    <label>üè∑Ô∏è Discount (%)</label>
    <input type="number" id="discount" min="0" max="100" value="0">
  </div>
  <div class="form-group">
    <label>üí≥ Paid By</label>
    <select id="paymentMethod">
        <option value="Cash">Cash</option>
        <option value="UPI">UPI</option>
        <option value="Card">Card</option>
    </select>
  </div>

  <button class="add-btn" onclick="addToCart()">Add to Cart</button>

  <table class="cart-table">
    <thead>
        <tr>
            <th>üõçÔ∏è Product</th>
            <th>üí∞ Price</th>
            <th>üì¶ Quantity</th>
            <th>üí≥ Amount</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody id="cartBody"></tbody>
  </table>

  <div class="total-section" id="totalSection" style="display:none;">
      Total: ‚Çπ<span id="totalAmount">0</span>
  </div>

  <button class="generate-btn" onclick="generateBill()">Generate Bill</button>

<script>
// Background changer
const backgrounds = [
 "https://st2.depositphotos.com/2933025/7386/i/950/depositphotos_73861925-stock-photo-newborn-baby-girl-seamless-pattern.jpg ",
 "https://img.freepik.com/fotos-premium/baby-shower-background-with-celebration-party-real_762118-3606.jpg",
 "https://thumbs.dreamstime.com/b/baby-shop-banner-template-kids-store-badge-newborn-symbols-seamless-pattern-vector-illustration-web-design-153996974.jpg",
 "https://images-na.ssl-images-amazon.com/images/I/51yzWxw5TvL._SL1000_.jpg",
 "https://www.shutterstock.com/shutterstock/photos/169972001/display_1500/stock-vector-baby-design-over-pink-and-blue-background-vector-illustration-169972001.jpg"
];
let bgIndex = 0;
function changeBackground() {
  document.body.style.background = `url("${backgrounds[bgIndex]}") no-repeat center center fixed`;
  document.body.style.backgroundSize = "cover";
  bgIndex = (bgIndex + 1) % backgrounds.length;
}
changeBackground();
setInterval(changeBackground, 10000);
</script>

<script>
const productsSelect = document.getElementById("products");
const cartBody = document.getElementById("cartBody");
const totalSection = document.getElementById("totalSection");
const totalAmountEl = document.getElementById("totalAmount");

async function loadProducts() {
    const res = await fetch("/products");
    const data = await res.json();
    for (const [name, price] of Object.entries(data.products)) {
        const option = document.createElement("option");
        option.value = name;
        option.text = `${name} - ‚Çπ${price}`;
        productsSelect.appendChild(option);
    }
}
loadProducts();

async function addToCart() {
    const product = productsSelect.value;
    const qty = parseInt(document.getElementById("quantity").value);
    if (!product || qty < 1) { alert("Select product and quantity"); return; }
    const res = await fetch("/cart/add", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ product, qty })
    });
    if (!res.ok) {
        const err = await res.json();
        alert("Error: " + (err.detail || "Could not add"));
        return;
    }
    const data = await res.json();
    renderCart(data.cart, data.total_amount);
}

function renderCart(cart, total) {
    cartBody.innerHTML = "";
    cart.forEach(item => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${item.product}</td>
            <td>‚Çπ${item.price}</td>
            <td>${item.qty}</td>
            <td>‚Çπ${item.amount}</td>
            <td><button class="remove-btn" onclick="removeItem('${encodeURIComponent(item.product)}')">‚ùå</button></td>
        `;
        cartBody.appendChild(row);
    });
    totalSection.style.display = cart.length ? "block" : "none";
    totalAmountEl.innerText = total !== undefined ? total : 0;
}

async function removeItem(encodedProduct) {
    const product = decodeURIComponent(encodedProduct);
    const res = await fetch(`/cart/remove/${encodeURIComponent(product)}`, { method: "DELETE" });
    if (!res.ok) {
        const err = await res.json();
        alert("Error: " + (err.detail || "Could not remove"));
        return;
    }
    const data = await res.json();
    renderCart(data.cart, data.total_amount);
}

async function generateBill() {
    const name = document.getElementById("customerName").value.trim();
    const phone = document.getElementById("phoneNo").value.trim();
     const email = document.getElementById("email").value.trim();
    const discountPercent = parseFloat(document.getElementById("discount").value) || 0;
    const paymentMethod = document.getElementById("paymentMethod").value;

      if (!name) { 
      alert("Enter customer name"); 
      return; 
    }

    // Allow empty phone, but if provided, must be 10 digits
    if (phone && !/^\d{10}$/.test(phone)) {
      alert("Phone number must be 10 digits");
      return;
    }

     if (email && !/^[a-z0-9._%+-]+@gmail\.com$/i.test(email)) {
      alert("Enter a valid Gmail address (example@gmail.com)");
      return;
    }
    
    let tableHTML = `
      <table style="width:100%; border-collapse:collapse; margin-top:15px;">
        <thead>
          <tr>
            <th style="padding:8px;">Product</th>
            <th style="padding:8px;">Price (‚Çπ)</th>
            <th style="padding:8px;">Qty</th>
            <th style="padding:8px;">Amount (‚Çπ)</th>
          </tr>
        </thead>
        <tbody>
    `;

    let subtotal = 0;
    const rows = cartBody.querySelectorAll("tr");
    if (rows.length === 0) {
      alert("Cart is empty. Add items before generating bill.");
      return;
    }

    rows.forEach(row => {
      const cols = row.querySelectorAll("td");
      const product = cols[0].innerText;
      const price = parseFloat(cols[1].innerText.replace("‚Çπ",""));
      const qty = parseInt(cols[2].innerText);
      const amount = parseFloat(cols[3].innerText.replace("‚Çπ",""));
      subtotal += amount;

      tableHTML += `
        <tr>
          <td style="padding:8px;">${product}</td>
          <td style="padding:8px;">‚Çπ${price}</td>
          <td style="padding:8px;">${qty}</td>
          <td style="padding:8px;">‚Çπ${amount}</td>
        </tr>
      `;
    });

    tableHTML += "</tbody></table>";

    const discountAmount = (subtotal * discountPercent) / 100;
    const afterDiscount = subtotal - discountAmount;
    const cgst = afterDiscount * 0.06;
    const sgst = afterDiscount * 0.06;
    const grandTotal = afterDiscount + cgst + sgst;


    // --- New Window Popup ---
    const billWindow = window.open("", "BillWindow", "width=380,height=700");
    billWindow.document.write(`
      <html>
      <head>
        <title>Tiny Toe Invoice</title>
        <style>
          body { font-family: 'Comic Sans MS'; padding:20px; background:#FFB6C1; }
          h2 { text-align:center; color:#e60073; margin: 2px}
          h3 { text-align:center; color:#e60073; margin: 2px  }
          table {  border-collapse:collapse; margin:20px 0; font-size:1rem; }
          th, td { padding:10px; border-collapse:collapse;border:0px solid #ddd; text-align:center; }
          .totals { margin-top:20px; font-size:1.1rem; }
          .totals p { margin:5px 0; text-align:right; }
          .thankyou { margin-top:15px; text-align:center; font-size:0.9rem; color:#e60073; font-family: 'Comic Sans MS'; font-weight: bold;}
        </style>
      </head>
      <body>
        <h2>üéÄ Tiny Toe Invoice üéÄ</h2>
        <h3> 143, cross main , Pondicherry</h3>
        <h3> Tel : +425 485 7896 </h3>
        <div style="border-top:2px dashed black; margin-top:30px; padding-top:10px; font-size:1.1rem; text-align:right;"></div>

        <p><strong>Customer:</strong> ${name}</p>
        <p><strong>Phone:</strong> ${phone}</p>
        <div style="border-top:2px dashed black; margin-top:30px; padding-top:10px; font-size:1.1rem; text-align:right;"></div>
            ${email ? `<p><strong>Email:</strong> ${email}</p>` : ""}
        <hr>
        ${tableHTML}
        <div class="totals">
          <div style="border-top:2px dashed black; margin-top:20px; font-size:1.1rem; text-align:right;">
            <p>Subtotal: ‚Çπ${subtotal.toFixed(2)}</p>
            <p>Discount (${discountPercent}%): -‚Çπ${discountAmount.toFixed(2)}</p>
            <p>CGST (6%): ‚Çπ${cgst.toFixed(2)}</p>
            <p>SGST (6%): ‚Çπ${sgst.toFixed(2)}</p>
            <p style="margin-top:20px; font-weight:bold; font-size:1.3rem; color:#e60073;">
              Grand Total: ‚Çπ${grandTotal.toFixed(2)}
         <div style="border-top:2px dashed black; margin-top:30px; padding-top:10px; font-size:1.1rem; text-align:right;"></div>
              </p>
            <p><strong>Date:</strong> ${new Date().toLocaleDateString("en-IN", { year:"numeric", month:"long", day:"numeric" })}</p>
            <p><strong>Paid By:</strong> ${paymentMethod}</p>
          </div>
        </div>
        <div class="thankyou">üíï Thank you for choosing Tiny Toe! üíï</div>
      </body>
      </html>
    `);
    billWindow.document.close();
    billWindow.print(); 
    

    // Clear cart after bill
    cartBody.innerHTML = "";
    await fetch("/cart", { method: "DELETE" }); 
    cartBody.innerHTML = "";
    totalSection.style.display = "none"; 
    totalAmountEl.innerText = 0;
} 
</script>
</body>
</html>




                                                                                



                                                                                 